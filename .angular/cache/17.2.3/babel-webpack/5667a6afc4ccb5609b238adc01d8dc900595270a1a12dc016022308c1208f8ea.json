{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { SubscriptionContainer } from '../../helper/subscription-container';\nlet CheckoutComponent = class CheckoutComponent {\n  constructor(service, authService, router, activatedRoute, title) {\n    this.service = service;\n    this.authService = authService;\n    this.router = router;\n    this.activatedRoute = activatedRoute;\n    this.title = title;\n    this.products = [];\n    this.totalCost = 0;\n    this.sameAsShipping = true;\n    this.alert = {};\n    this.subscription = new SubscriptionContainer();\n    this.success = false;\n    this.showCheckout = true;\n    this.pageName = 'cart';\n  }\n  ngOnInit() {\n    this.title.setTitle('Purilo | Checkout');\n    this.products = JSON.parse(this.service.getProducts());\n    this.getStates();\n    this.service.pageName$.subscribe(pageName => {\n      this.pageName = pageName;\n    });\n    this.customerForm = new FormGroup({\n      email: new FormControl('', [Validators.required, Validators.pattern('^[\\\\w-\\\\.]+@([\\\\w-]+\\\\.)+[\\\\w-]{2,4}$')])\n    });\n    this.shippingForm = new FormGroup({\n      firstName: new FormControl('', Validators.required),\n      lastName: new FormControl('', Validators.required),\n      phoneNumber: new FormControl('', [Validators.required, Validators.pattern('^[0-9]{10}$')]),\n      address: new FormControl('', Validators.required),\n      apartment: new FormControl(''),\n      city: new FormControl('', Validators.required),\n      state: new FormControl('', Validators.required),\n      postalCode: new FormControl('', [Validators.required, Validators.pattern('^[0-9]{0,6}$')])\n    });\n    this.billingForm = new FormGroup({\n      firstName: new FormControl('', Validators.required),\n      lastName: new FormControl('', Validators.required),\n      phoneNumber: new FormControl('', [Validators.required, Validators.pattern('^[0-9]{10}$')]),\n      address: new FormControl('', Validators.required),\n      apartment: new FormControl(''),\n      city: new FormControl('', Validators.required),\n      state: new FormControl('', Validators.required),\n      postalCode: new FormControl('', [Validators.required, Validators.pattern('^[0-9]{0,6}$')])\n    });\n  }\n  getStates() {\n    this.subscription.addSubscription = this.service.fetchStates().subscribe(response => {\n      this.states = response;\n    });\n  }\n  calculateTotalCost() {\n    this.totalCost = 0;\n    this.products.forEach(product => {\n      this.totalCost = this.totalCost + product.cost * (product.noOfItems ?? 0);\n    });\n    return this.totalCost;\n  }\n  setBillingForm() {\n    if (this.sameAsShipping) {\n      this.billingForm.setValue(this.shippingForm.value);\n    } else {\n      this.billingForm.reset();\n    }\n  }\n  submitCustomerForm() {\n    if (this.customerForm.invalid && !this.isLoggedIn()) {\n      this.customerForm.markAllAsTouched();\n    } else {\n      this.customerForm?.get('email')?.setValue(this.getUserEmail());\n    }\n  }\n  pay() {\n    this.setBillingForm();\n    this.submitCustomerForm();\n    if (this.shippingForm.valid && this.billingForm.valid && this.customerForm.valid) {\n      this.service.placeOrder(this.products, this.shippingForm.value, this.billingForm.value, this.customerForm.value).subscribe();\n      this.success = true;\n      this.alert = {\n        isErrorMessage: false,\n        isSuccessMessage: true,\n        message: 'Thank you for shopping at Purilo. Your order has been placed successfully.'\n      };\n      this.showCheckout = false;\n      //Empty localstorage\n      this.service.removeProducts();\n    } else {\n      this.showCheckout = true;\n      this.alert = {\n        isErrorMessage: true,\n        isSuccessMessage: false,\n        message: 'Kindly fill all the sections'\n      };\n    }\n  }\n  isLoggedIn() {\n    return this.authService.isLoggedIn();\n  }\n  getUserEmail() {\n    return this.authService.getLoggedInUser().email;\n  }\n  navigateToLogin($event) {\n    $event.preventDefault();\n    this.authService.setCurrentRoute(this.router.routerState.snapshot.url);\n    this.router.navigate(['../login'], {\n      relativeTo: this.activatedRoute\n    });\n  }\n  ngOnDestroy() {\n    this.subscription.removeSubscription();\n  }\n};\nCheckoutComponent = __decorate([Component({\n  selector: 'app-checkout',\n  templateUrl: './checkout.component.html',\n  styleUrls: ['./checkout.component.scss']\n})], CheckoutComponent);\nexport { CheckoutComponent };","map":{"version":3,"names":["Component","FormControl","FormGroup","Validators","SubscriptionContainer","CheckoutComponent","constructor","service","authService","router","activatedRoute","title","products","totalCost","sameAsShipping","alert","subscription","success","showCheckout","pageName","ngOnInit","setTitle","JSON","parse","getProducts","getStates","pageName$","subscribe","customerForm","email","required","pattern","shippingForm","firstName","lastName","phoneNumber","address","apartment","city","state","postalCode","billingForm","addSubscription","fetchStates","response","states","calculateTotalCost","forEach","product","cost","noOfItems","setBillingForm","setValue","value","reset","submitCustomerForm","invalid","isLoggedIn","markAllAsTouched","get","getUserEmail","pay","valid","placeOrder","isErrorMessage","isSuccessMessage","message","removeProducts","getLoggedInUser","navigateToLogin","$event","preventDefault","setCurrentRoute","routerState","snapshot","url","navigate","relativeTo","ngOnDestroy","removeSubscription","__decorate","selector","templateUrl","styleUrls"],"sources":["D:\\Development\\Angular\\e-commerce\\src\\app\\components\\checkout\\checkout.component.ts"],"sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MarketService } from '../../service/market.service';\nimport { Product } from '../../interface/product';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { Alert } from 'src/app/interface/alert';\nimport { SubscriptionContainer } from '../../helper/subscription-container';\nimport { AuthService } from '../../service/auth.service';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Title } from '@angular/platform-browser';\n\n@Component({\n\tselector: 'app-checkout',\n\ttemplateUrl: './checkout.component.html',\n\tstyleUrls: ['./checkout.component.scss'],\n})\nexport class CheckoutComponent implements OnInit, OnDestroy {\n\tproducts: Product[] = [];\n\ttotalCost: number = 0;\n\tshippingForm!: FormGroup;\n\tbillingForm!: FormGroup;\n\tcustomerForm!: FormGroup;\n\tsameAsShipping: boolean = true;\n\talert: Alert = {} as Alert;\n\tstates: any;\n\tsubscription = new SubscriptionContainer();\n\tsuccess: boolean = false;\n\tshowCheckout: boolean = true;\n\tpageName: string = 'cart';\n\n\tconstructor(\n\t\tprivate service: MarketService,\n\t\tprivate authService: AuthService,\n\t\tprivate router: Router,\n\t\tprivate activatedRoute: ActivatedRoute,\n\t\tprivate title: Title\n\t) {}\n\n\tngOnInit(): void {\n\t\tthis.title.setTitle('Purilo | Checkout');\n\t\tthis.products = JSON.parse(this.service.getProducts());\n\t\tthis.getStates();\n\n\t\tthis.service.pageName$.subscribe((pageName) => {\n\t\t\tthis.pageName = pageName;\n\t\t});\n\n\t\tthis.customerForm = new FormGroup({\n\t\t\temail: new FormControl('', [\n\t\t\t\tValidators.required,\n\t\t\t\tValidators.pattern('^[\\\\w-\\\\.]+@([\\\\w-]+\\\\.)+[\\\\w-]{2,4}$'),\n\t\t\t]),\n\t\t});\n\n\t\tthis.shippingForm = new FormGroup({\n\t\t\tfirstName: new FormControl('', Validators.required),\n\t\t\tlastName: new FormControl('', Validators.required),\n\t\t\tphoneNumber: new FormControl('', [\n\t\t\t\tValidators.required,\n\t\t\t\tValidators.pattern('^[0-9]{10}$'),\n\t\t\t]),\n\t\t\taddress: new FormControl('', Validators.required),\n\t\t\tapartment: new FormControl(''),\n\t\t\tcity: new FormControl('', Validators.required),\n\t\t\tstate: new FormControl('', Validators.required),\n\t\t\tpostalCode: new FormControl('', [\n\t\t\t\tValidators.required,\n\t\t\t\tValidators.pattern('^[0-9]{0,6}$'),\n\t\t\t]),\n\t\t});\n\n\t\tthis.billingForm = new FormGroup({\n\t\t\tfirstName: new FormControl('', Validators.required),\n\t\t\tlastName: new FormControl('', Validators.required),\n\t\t\tphoneNumber: new FormControl('', [\n\t\t\t\tValidators.required,\n\t\t\t\tValidators.pattern('^[0-9]{10}$'),\n\t\t\t]),\n\t\t\taddress: new FormControl('', Validators.required),\n\t\t\tapartment: new FormControl(''),\n\t\t\tcity: new FormControl('', Validators.required),\n\t\t\tstate: new FormControl('', Validators.required),\n\t\t\tpostalCode: new FormControl('', [\n\t\t\t\tValidators.required,\n\t\t\t\tValidators.pattern('^[0-9]{0,6}$'),\n\t\t\t]),\n\t\t});\n\t}\n\n\tgetStates() {\n\t\tthis.subscription.addSubscription = this.service\n\t\t\t.fetchStates()\n\t\t\t.subscribe((response) => {\n\t\t\t\tthis.states = response;\n\t\t\t});\n\t}\n\n\tcalculateTotalCost() {\n\t\tthis.totalCost = 0;\n\t\tthis.products.forEach((product) => {\n\t\t\tthis.totalCost =\n\t\t\t\tthis.totalCost + product.cost * (product.noOfItems ?? 0);\n\t\t});\n\n\t\treturn this.totalCost;\n\t}\n\n\tsetBillingForm() {\n\t\tif (this.sameAsShipping) {\n\t\t\tthis.billingForm.setValue(this.shippingForm.value);\n\t\t} else {\n\t\t\tthis.billingForm.reset();\n\t\t}\n\t}\n\n\tsubmitCustomerForm() {\n\t\tif (this.customerForm.invalid && !this.isLoggedIn()) {\n\t\t\tthis.customerForm.markAllAsTouched();\n\t\t} else {\n\t\t\tthis.customerForm?.get('email')?.setValue(this.getUserEmail());\n\t\t}\n\t}\n\n\tpay() {\n\t\tthis.setBillingForm();\n\t\tthis.submitCustomerForm();\n\t\tif (\n\t\t\tthis.shippingForm.valid &&\n\t\t\tthis.billingForm.valid &&\n\t\t\tthis.customerForm.valid\n\t\t) {\n\t\t\tthis.service\n\t\t\t\t.placeOrder(\n\t\t\t\t\tthis.products,\n\t\t\t\t\tthis.shippingForm.value,\n\t\t\t\t\tthis.billingForm.value,\n\t\t\t\t\tthis.customerForm.value\n\t\t\t\t)\n\t\t\t\t.subscribe();\n\t\t\tthis.success = true;\n\t\t\tthis.alert = {\n\t\t\t\tisErrorMessage: false,\n\t\t\t\tisSuccessMessage: true,\n\t\t\t\tmessage:\n\t\t\t\t\t'Thank you for shopping at Purilo. Your order has been placed successfully.',\n\t\t\t};\n\t\t\tthis.showCheckout = false;\n\t\t\t//Empty localstorage\n\t\t\tthis.service.removeProducts();\n\t\t} else {\n\t\t\tthis.showCheckout = true;\n\t\t\tthis.alert = {\n\t\t\t\tisErrorMessage: true,\n\t\t\t\tisSuccessMessage: false,\n\t\t\t\tmessage: 'Kindly fill all the sections',\n\t\t\t};\n\t\t}\n\t}\n\n\tisLoggedIn() {\n\t\treturn this.authService.isLoggedIn();\n\t}\n\n\tgetUserEmail() {\n\t\treturn this.authService.getLoggedInUser().email;\n\t}\n\n\tnavigateToLogin($event: MouseEvent) {\n\t\t$event.preventDefault();\n\t\tthis.authService.setCurrentRoute(this.router.routerState.snapshot.url);\n\t\tthis.router.navigate(['../login'], { relativeTo: this.activatedRoute });\n\t}\n\n\tngOnDestroy(): void {\n\t\tthis.subscription.removeSubscription();\n\t}\n}\n"],"mappings":";AAAA,SAASA,SAAS,QAA2B,eAAe;AAG5D,SAASC,WAAW,EAAEC,SAAS,EAAEC,UAAU,QAAQ,gBAAgB;AAEnE,SAASC,qBAAqB,QAAQ,qCAAqC;AAUpE,IAAMC,iBAAiB,GAAvB,MAAMA,iBAAiB;EAc7BC,YACSC,OAAsB,EACtBC,WAAwB,EACxBC,MAAc,EACdC,cAA8B,EAC9BC,KAAY;IAJZ,KAAAJ,OAAO,GAAPA,OAAO;IACP,KAAAC,WAAW,GAAXA,WAAW;IACX,KAAAC,MAAM,GAANA,MAAM;IACN,KAAAC,cAAc,GAAdA,cAAc;IACd,KAAAC,KAAK,GAALA,KAAK;IAlBd,KAAAC,QAAQ,GAAc,EAAE;IACxB,KAAAC,SAAS,GAAW,CAAC;IAIrB,KAAAC,cAAc,GAAY,IAAI;IAC9B,KAAAC,KAAK,GAAU,EAAW;IAE1B,KAAAC,YAAY,GAAG,IAAIZ,qBAAqB,EAAE;IAC1C,KAAAa,OAAO,GAAY,KAAK;IACxB,KAAAC,YAAY,GAAY,IAAI;IAC5B,KAAAC,QAAQ,GAAW,MAAM;EAQtB;EAEHC,QAAQA,CAAA;IACP,IAAI,CAACT,KAAK,CAACU,QAAQ,CAAC,mBAAmB,CAAC;IACxC,IAAI,CAACT,QAAQ,GAAGU,IAAI,CAACC,KAAK,CAAC,IAAI,CAAChB,OAAO,CAACiB,WAAW,EAAE,CAAC;IACtD,IAAI,CAACC,SAAS,EAAE;IAEhB,IAAI,CAAClB,OAAO,CAACmB,SAAS,CAACC,SAAS,CAAER,QAAQ,IAAI;MAC7C,IAAI,CAACA,QAAQ,GAAGA,QAAQ;IACzB,CAAC,CAAC;IAEF,IAAI,CAACS,YAAY,GAAG,IAAI1B,SAAS,CAAC;MACjC2B,KAAK,EAAE,IAAI5B,WAAW,CAAC,EAAE,EAAE,CAC1BE,UAAU,CAAC2B,QAAQ,EACnB3B,UAAU,CAAC4B,OAAO,CAAC,uCAAuC,CAAC,CAC3D;KACD,CAAC;IAEF,IAAI,CAACC,YAAY,GAAG,IAAI9B,SAAS,CAAC;MACjC+B,SAAS,EAAE,IAAIhC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MACnDI,QAAQ,EAAE,IAAIjC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MAClDK,WAAW,EAAE,IAAIlC,WAAW,CAAC,EAAE,EAAE,CAChCE,UAAU,CAAC2B,QAAQ,EACnB3B,UAAU,CAAC4B,OAAO,CAAC,aAAa,CAAC,CACjC,CAAC;MACFK,OAAO,EAAE,IAAInC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MACjDO,SAAS,EAAE,IAAIpC,WAAW,CAAC,EAAE,CAAC;MAC9BqC,IAAI,EAAE,IAAIrC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MAC9CS,KAAK,EAAE,IAAItC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MAC/CU,UAAU,EAAE,IAAIvC,WAAW,CAAC,EAAE,EAAE,CAC/BE,UAAU,CAAC2B,QAAQ,EACnB3B,UAAU,CAAC4B,OAAO,CAAC,cAAc,CAAC,CAClC;KACD,CAAC;IAEF,IAAI,CAACU,WAAW,GAAG,IAAIvC,SAAS,CAAC;MAChC+B,SAAS,EAAE,IAAIhC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MACnDI,QAAQ,EAAE,IAAIjC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MAClDK,WAAW,EAAE,IAAIlC,WAAW,CAAC,EAAE,EAAE,CAChCE,UAAU,CAAC2B,QAAQ,EACnB3B,UAAU,CAAC4B,OAAO,CAAC,aAAa,CAAC,CACjC,CAAC;MACFK,OAAO,EAAE,IAAInC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MACjDO,SAAS,EAAE,IAAIpC,WAAW,CAAC,EAAE,CAAC;MAC9BqC,IAAI,EAAE,IAAIrC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MAC9CS,KAAK,EAAE,IAAItC,WAAW,CAAC,EAAE,EAAEE,UAAU,CAAC2B,QAAQ,CAAC;MAC/CU,UAAU,EAAE,IAAIvC,WAAW,CAAC,EAAE,EAAE,CAC/BE,UAAU,CAAC2B,QAAQ,EACnB3B,UAAU,CAAC4B,OAAO,CAAC,cAAc,CAAC,CAClC;KACD,CAAC;EACH;EAEAN,SAASA,CAAA;IACR,IAAI,CAACT,YAAY,CAAC0B,eAAe,GAAG,IAAI,CAACnC,OAAO,CAC9CoC,WAAW,EAAE,CACbhB,SAAS,CAAEiB,QAAQ,IAAI;MACvB,IAAI,CAACC,MAAM,GAAGD,QAAQ;IACvB,CAAC,CAAC;EACJ;EAEAE,kBAAkBA,CAAA;IACjB,IAAI,CAACjC,SAAS,GAAG,CAAC;IAClB,IAAI,CAACD,QAAQ,CAACmC,OAAO,CAAEC,OAAO,IAAI;MACjC,IAAI,CAACnC,SAAS,GACb,IAAI,CAACA,SAAS,GAAGmC,OAAO,CAACC,IAAI,IAAID,OAAO,CAACE,SAAS,IAAI,CAAC,CAAC;IAC1D,CAAC,CAAC;IAEF,OAAO,IAAI,CAACrC,SAAS;EACtB;EAEAsC,cAAcA,CAAA;IACb,IAAI,IAAI,CAACrC,cAAc,EAAE;MACxB,IAAI,CAAC2B,WAAW,CAACW,QAAQ,CAAC,IAAI,CAACpB,YAAY,CAACqB,KAAK,CAAC;KAClD,MAAM;MACN,IAAI,CAACZ,WAAW,CAACa,KAAK,EAAE;;EAE1B;EAEAC,kBAAkBA,CAAA;IACjB,IAAI,IAAI,CAAC3B,YAAY,CAAC4B,OAAO,IAAI,CAAC,IAAI,CAACC,UAAU,EAAE,EAAE;MACpD,IAAI,CAAC7B,YAAY,CAAC8B,gBAAgB,EAAE;KACpC,MAAM;MACN,IAAI,CAAC9B,YAAY,EAAE+B,GAAG,CAAC,OAAO,CAAC,EAAEP,QAAQ,CAAC,IAAI,CAACQ,YAAY,EAAE,CAAC;;EAEhE;EAEAC,GAAGA,CAAA;IACF,IAAI,CAACV,cAAc,EAAE;IACrB,IAAI,CAACI,kBAAkB,EAAE;IACzB,IACC,IAAI,CAACvB,YAAY,CAAC8B,KAAK,IACvB,IAAI,CAACrB,WAAW,CAACqB,KAAK,IACtB,IAAI,CAAClC,YAAY,CAACkC,KAAK,EACtB;MACD,IAAI,CAACvD,OAAO,CACVwD,UAAU,CACV,IAAI,CAACnD,QAAQ,EACb,IAAI,CAACoB,YAAY,CAACqB,KAAK,EACvB,IAAI,CAACZ,WAAW,CAACY,KAAK,EACtB,IAAI,CAACzB,YAAY,CAACyB,KAAK,CACvB,CACA1B,SAAS,EAAE;MACb,IAAI,CAACV,OAAO,GAAG,IAAI;MACnB,IAAI,CAACF,KAAK,GAAG;QACZiD,cAAc,EAAE,KAAK;QACrBC,gBAAgB,EAAE,IAAI;QACtBC,OAAO,EACN;OACD;MACD,IAAI,CAAChD,YAAY,GAAG,KAAK;MACzB;MACA,IAAI,CAACX,OAAO,CAAC4D,cAAc,EAAE;KAC7B,MAAM;MACN,IAAI,CAACjD,YAAY,GAAG,IAAI;MACxB,IAAI,CAACH,KAAK,GAAG;QACZiD,cAAc,EAAE,IAAI;QACpBC,gBAAgB,EAAE,KAAK;QACvBC,OAAO,EAAE;OACT;;EAEH;EAEAT,UAAUA,CAAA;IACT,OAAO,IAAI,CAACjD,WAAW,CAACiD,UAAU,EAAE;EACrC;EAEAG,YAAYA,CAAA;IACX,OAAO,IAAI,CAACpD,WAAW,CAAC4D,eAAe,EAAE,CAACvC,KAAK;EAChD;EAEAwC,eAAeA,CAACC,MAAkB;IACjCA,MAAM,CAACC,cAAc,EAAE;IACvB,IAAI,CAAC/D,WAAW,CAACgE,eAAe,CAAC,IAAI,CAAC/D,MAAM,CAACgE,WAAW,CAACC,QAAQ,CAACC,GAAG,CAAC;IACtE,IAAI,CAAClE,MAAM,CAACmE,QAAQ,CAAC,CAAC,UAAU,CAAC,EAAE;MAAEC,UAAU,EAAE,IAAI,CAACnE;IAAc,CAAE,CAAC;EACxE;EAEAoE,WAAWA,CAAA;IACV,IAAI,CAAC9D,YAAY,CAAC+D,kBAAkB,EAAE;EACvC;CACA;AAhKY1E,iBAAiB,GAAA2E,UAAA,EAL7BhF,SAAS,CAAC;EACViF,QAAQ,EAAE,cAAc;EACxBC,WAAW,EAAE,2BAA2B;EACxCC,SAAS,EAAE,CAAC,2BAA2B;CACvC,CAAC,C,EACW9E,iBAAiB,CAgK7B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}